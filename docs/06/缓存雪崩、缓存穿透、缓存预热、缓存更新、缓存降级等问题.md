# 缓存雪崩、缓存穿透、缓存预热、缓存更新、缓存降级等问题

### 一、缓存雪崩
**定义**:由于原有缓存失效，新缓存未到期间,直接导致原先查缓存的数据，直接全部去查数据库了，对数据库cpu和内存啥造成很大压力，严重会造成数据库宕机。

**解决方案**：
- 1、使用锁或队列；保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上
- 2、设置过期标志更新缓存；比如缓存时间为20min，则缓存过期标记时间为10min，当到了缓存过期标记的时候，则触发通知另外的线程在后台去更新实际key的缓存。
- 3、为key设置不同的缓存失效时间；在固定的一个缓存时间的基础上+随机一个时间作为缓存失效时间
- 4、二级缓存；设置一个有时间限制的缓存+一个无时间限制的缓存

### 二、缓存穿透
**定义**：缓存穿透指的是用户查询数据，在数据库中没有，自然在缓存中也没有，每次查询都是两次无意义的查询，也是绕过缓存，直接查数据库的。

**解决方案**：采用**布隆过滤器**，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力

备注：
[布隆过滤器是什么？](什么是布隆过滤器.md)

### 三、缓存预热
**定义**：缓存预热，就是在系统上线的后，将相关需要缓存数据直接加到缓存系统中。

**解决思路**：
- 直接写个缓存刷新页面，上线时手工操作下
- 数据量不大，可以在项目启动的时候自动进行加载
- 定时刷新缓存

### 四、缓存更新
除Redis系统自带的缓存失效策略，常见采用以下两种：
- 定时去清理过期的缓存；
- 当有用户请求过来时，再判断这个请求所用到的缓存是否过期，过期的话就去底层系统得到新数据并更新缓存。

### 五、缓存降级
降级的目的是保证核心服务可用，即使是有损的，而且有些服务是无法降级的（如电商的购物流程等）

在进行降级之前要对系统进行梳理，从而梳理出哪些必须保护，哪些可降级；




参考文件：https://mp.weixin.qq.com/s?__biz=MzI1NDQ3MjQxNA==&mid=2247485464&idx=1&sn=8d690fc6f878aadf75977aa7e76cfd08&chksm=e9c5f1a9deb278bf512d8b40c30240d0168cdf2cf02142ee913bc11ec39637ca380a4dad524b&scene=21#wechat_redirect
